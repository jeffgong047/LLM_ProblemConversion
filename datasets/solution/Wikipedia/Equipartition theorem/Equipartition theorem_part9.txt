theorem: See also: Generalized coordinates, Hamiltonian mechanics, Microcanonical ensemble, and Canonical ensemble The most general form of the equipartition theorem states that under suitable assumptions (discussed below), for a physical system with Hamiltonian energy function H and degrees of freedom xn, the following equipartition formula holds in thermal equilibrium for all indices m and n:[6][10][13] ⟨xm∂H∂xn⟩=δmnkBT._m/_n⟩=δ_mnk_BT. Here δmn is the Kronecker delta, which is equal to one if m = n and is zero otherwise. The averaging brackets ⟨…⟩⟨…⟩ is assumed to be an ensemble average over phase space or, under an assumption of ergodicity, a time average of a single system. The general equipartition theorem holds in both the microcanonical ensemble,[10] when the total energy of the system is constant, and also in the canonical ensemble,[6][34] when the system is coupled to a heat bath with which it can exchange energy. Derivations of the general formula are given later in the article. The general formula is equivalent to the following two: ⟨xn∂H∂xn⟩=kBTforalln_n/_n⟩=k_BT foralln ⟨xm∂H∂xn⟩=0forallm≠n._m/_n⟩=0 forallm. If a degree of freedom xn appears only as a quadratic term anxn2 in the Hamiltonian H, then the first of these formulae implies that kBT=⟨xn∂H∂xn⟩=2⟨anxn2⟩,_BT=_n/_n⟩=2_nx_n^2⟩, which is twice the contribution that this degree of freedom makes to the average energy ⟨H⟩⟩. Thus the equipartition theorem for systems with quadratic energies follows easily from the general formula. A similar argument, with 2 replaced by s, applies to energies of the form anxns. The degrees of freedom xn are coordinates on the phase space of the system and are therefore commonly subdivided into generalized position coordinates qk and generalized momentum coordinates pk, where pk is the conjugate momentum to qk. In this situation, formula 1 means that for all k, ⟨pk∂H∂pk⟩=⟨qk∂H∂qk⟩=kBT._k/_k⟩=_k/_k⟩=k_BT. Using the equations of Hamiltonian mechanics,[9] these formulae may also be written ⟨pkdqkdt⟩=−⟨qkdpkdt⟩=kBT._kdq_k/dt⟩=-_kdp_k/dt⟩=k_BT. Similarly, one can show using formula 2 that ⟨qj∂H∂pk⟩=⟨pj∂H∂qk⟩=0forallj,k_j/_k⟩=_j/_k⟩=0 forall j,k and ⟨qj∂H∂qk⟩=⟨pj∂H∂pk⟩=0forallj≠k._j/_k⟩=_j/_k⟩=0 forall j. Relation to the virial