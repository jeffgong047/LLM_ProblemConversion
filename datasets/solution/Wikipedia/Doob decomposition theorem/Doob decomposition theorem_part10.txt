Application: In mathematical finance, the Doob decomposition theorem can be used to determine the largest optimal exercise time of an American option.[6][7] Let X = (X0, X1, . . . , XN) denote the non-negative, discounted payoffs of an American option in a N-period financial market model, adapted to a filtration (F0, F1, . . . , FN), and let Qℚ denote an equivalent martingale measure. Let U = (U0, U1, . . . , UN) denote the Snell envelope of X with respect to Qℚ. The Snell envelope is the smallest Qℚ-supermartingale dominating X[8] and in a complete financial market it represents the minimal amount of capital necessary to hedge the American option up to maturity.[9] Let U = M + A denote the Doob decomposition with respect to Qℚ of the Snell envelope U into a martingale M = (M0, M1, . . . , MN) and a decreasing predictable process A = (A0, A1, . . . , AN) with A0 = 0. Then the largest stopping time to exercise the American option in an optimal way[10][11] is τmax:=NifAN=0,minn∈0,…,N−1∣An+1<0ifAN<0.τ_max:=N ifA_N=0, min{n∈{0,…,N-1}_n+1<0} ifA_N<0. Since A is predictable, the event {τmax = n} = {An = 0, An+1 < 0} is in Fn for every n ∈ {0, 1, . . . , N − 1}, hence τmax is indeed a stopping time. It gives the last moment before the discounted value of the American option will drop in expectation; up to time τmax the discounted value process U is a martingale with respect to Qℚ.