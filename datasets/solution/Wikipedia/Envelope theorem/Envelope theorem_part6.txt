theory: Consider an agent whose utility function f(x,t)(x,t) over outcomes x∈X¯∈X̅ depends on his type t∈[0,1]∈0,1]. Let X⊆X¯⊆X̅ represent the "menu" of possible outcomes the agent could obtain in the mechanism by sending different messages. The agent's equilibrium utility V(t)(t) in the mechanism is then given by (1), and the set X∗(t)^∗(t) of the mechanism's equilibrium outcomes is given by (2). Any selection x∗(t)∈X∗(t)^∗(t)^∗(t) is a choice rule implemented by the mechanism. Suppose that the agent's utility function f(x,t)(x,t) is differentiable and absolutely continuous in t for all x∈Y, and that supx∈X¯|ft(x,t)|sup_x∈X̅|f_t(x,t)| is integrable on [0,1][0,1]. Then Theorem 2 implies that the agent's equilibrium utility V in any mechanism implementing a given choice rule x∗^∗ must satisfy the integral condition (4). The integral condition (4) is a key step in the analysis of mechanism design problems with continuous type spaces. In particular, in Myerson's (1981) analysis of single-item auctions, the outcome from the viewpoint of one bidder can be described as x=(y,z)=(y,z), where y is the bidder's probability of receiving the object and z is his expected payment, and the bidder's expected utility takes the form f((y,z),t)=ty−z((y,z),t)=ty-z. In this case, letting t_t denote the bidder's lowest possible type, the integral condition (4) for the bidder's equilibrium expected utility V takes the form V(t)−V(t_)=∫0ty∗(s)ds.(t)-V(t)=∫_0^ty^∗(s)ds. (This equation can be interpreted as the producer surplus formula for the firm whose production technology for converting numeraire z into probability y of winning the object is defined by the auction and which resells the object at a fixed price t). This condition in turn yields Myerson's (1981) celebrated revenue equivalence theorem: the expected revenue generated in an auction in which bidders have independent private values is fully determined by the bidders' probabilities y∗(t)^∗(t) of getting the object for all types t as well as by the expected payoffs V(t_)(t) of the bidders' lowest types. Finally, this condition is a key step in Myerson's (1981) of optimal auctions.[6] For other applications of the envelope theorem to mechanism design see Mirrlees (1971),[7] Holmstrom (1979),[8] Laffont and Maskin (1980),[9] Riley and Samuelson (1981),[10] Fudenberg and Tirole (1991),[11] and Williams (1999).[12] While these authors derived and exploited the envelope theorem by restricting attention to (piecewise) continuously differentiable choice rules or even narrower classes, it may sometimes be optimal to implement a choice rule that is not piecewise continuously differentiable. (One example is the class of trading problems with linear utility described in chapter 6.5 of Myerson (1991).[13]) Note that the integral condition (3) still holds in this setting and implies such important results as Holmstrom's lemma (Holmstrom, 1979),[8] Myerson's lemma (Myerson, 1981),[6] the revenue equivalence theorem (for auctions), the Green–Laffont–Holmstrom theorem (Green and Laffont, 1979; Holmstrom, 1979),[14][8] the Myerson–Satterthwaite inefficiency theorem (Myerson and Satterthwaite, 1983),[15] the Jehiel–Moldovanu impossibility theorems (Jehiel and Moldovanu, 2001),[16] the McAfee–McMillan weak-cartels theorem (McAfee and McMillan, 1992),[17] and Weber's martingale theorem (Weber, 1983),[18] etc. The details of these applications are provided in Chapter 3 of Milgrom (2004),[19] who offers an elegant and unifying framework in auction and mechanism design analysis mainly based on the envelope theorem and other familiar techniques and concepts in demand theory. Applications to multidimensional parameter