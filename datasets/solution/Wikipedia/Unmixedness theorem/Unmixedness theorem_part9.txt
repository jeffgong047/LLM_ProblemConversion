criterion: There is a remarkable characterization of Cohen–Macaulay rings, sometimes called miracle flatness or Hironaka's criterion. Let R be a local ring which is finitely generated as a module over some regular local ring A contained in R. Such a subring exists for any localization R at a prime ideal of a finitely generated algebra over a field, by the Noether normalization lemma; it also exists when R is complete and contains a field, or when R is a complete domain.[12] Then R is Cohen–Macaulay if and only if it is flat as an A-module; it is also equivalent to say that R is free as an A-module.[13] A geometric reformulation is as follows. Let X be a connected affine scheme of finite type over a field K (for example, an affine variety). Let n be the dimension of X. By Noether normalization, there is a finite morphism f from X to affine space An over K. Then X is Cohen–Macaulay if and only if all fibers of f have the same degree.[14] It is striking that this property is independent of the choice of f. Finally, there is a version of Miracle Flatness for graded rings. Let R be a finitely generated commutative graded algebra over a field K, R=K⊕R1⊕R2⊕⋯.=K_1_2⊕⋯. There is always a graded polynomial subring A ⊂ R (with generators in various degrees) such that R is finitely generated as an A-module. Then R is Cohen–Macaulay if and only if R is free as a graded A-module. Again, it follows that this freeness is independent of the choice of the polynomial subring A.